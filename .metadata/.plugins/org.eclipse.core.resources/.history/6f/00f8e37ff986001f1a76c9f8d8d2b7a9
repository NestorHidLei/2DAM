package mainApp;

import java.sql.Timestamp;
import java.util.ArrayList;
import java.util.Iterator;
import java.util.List;
import java.io.BufferedReader;
import java.io.BufferedWriter;
import java.io.FileReader;
import java.io.FileWriter;
import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;

import conexion.Conexion;
import resources.Asignatura;
import resources.Profesor;

public class MainApp {
	
	private static final String INSERTAR_PROFESORES = "INSERT INTO Profesores(NIF, Nombre, Especialidad, Telefono) VALUES (?,?,?,?)";
	private static final String INSETAR_ASIGNATURAS = "INSERT INTO Asignatura(CodAsignatura, Nombre) VALUES(?,?,?)";

	public static void main(String[] args) {
		String linea = "";
		List<Profesor> listaProfesores = new ArrayList<>();
		List<Asignatura> listaAsignaturas = new ArrayList<>();
		try(Connection connect = Conexion.conectar()){
			try (BufferedReader br = new BufferedReader(new FileReader("src/main/java/Fichero.csv"))) {
				while(linea != null) {
					linea = br.readLine();
					if (linea.startsWith("P")) {
						String[] campos = linea.split(";");
						String NIF = campos[1];
						String Nombre = campos[2];
						String Especialidad = campos[3];
						String Telefono = campos[4];
						Profesor profesor = new Profesor(NIF, Nombre, Especialidad, Telefono);
						listaProfesores.add(profesor);
					} else if (linea.startsWith("A")) {
						String[] campos = linea.split(";");
						String codAsignatura = campos[1];
						String Nombre = campos[2];
						Asignatura asignatura = new Asignatura(codAsignatura, Nombre);
						listaAsignaturas.add(asignatura);
					}
				}
			} catch (Exception e) {
				System.err.println("Error al leer el archivo" + e.getMessage());
			}
			
			try {
				connect.setAutoCommit(false);
				PreparedStatement st = connect.prepareStatement(INSERTAR_PROFESORES,PreparedStatement.RETURN_GENERATED_KEYS);
				for (Profesor profesores : listaProfesores) {
					st.setString(1, profesores.getNIF());
					st.setString(2, profesores.getNombre());
					st.setString(3, profesores.getEspecialidad());
					st.setString(3, profesores.getTel√©fono());
				}
				
				PreparedStatement st2 = connect.prepareStatement(INSETAR_ASIGNATURAS,PreparedStatement.RETURN_GENERATED_KEYS);
				for (Asignatura asignatura : listaAsignaturas) {
					st2.setString(1, asignatura.getCodAsignatura());
					st2.setString(2, asignatura.getNombre());

				}
				
				st.executeUpdate();
				st2.executeUpdate();
				connect.commit();
				
			}catch (Exception e) {
				connect.rollback();
			}
			
		} catch (Exception e) {
			
		}
	}
}
